# VCF Filtering by Genomic Accessibility

## Overview

Variant Call Format (VCF) filtering by genomic accessibility is a critical quality control step in genomic analysis pipelines. This process involves restricting variant calls to regions of the genome that are reliably sequenced and assembled, thereby improving the accuracy and reliability of downstream analyses.

## Genomic Accessibility: Euchromatin vs. Heterochromatin

### Euchromatic Regions
Euchromatic regions represent the transcriptionally active, gene-rich portions of the genome characterized by:

- **Open chromatin structure**: Loosely packed DNA that is accessible to sequencing technologies
- **High mappability**: Unique sequences that allow for unambiguous read alignment
- **Consistent sequencing coverage**: Uniform depth distribution across the region
- **Low repetitive content**: Minimal presence of tandem repeats, transposable elements, and segmental duplications

### Heterochromatic Regions
Heterochromatic regions pose significant challenges for sequencing and variant calling due to:

- **Condensed chromatin structure**: Tightly packed DNA that may be inaccessible to sequencing enzymes
- **Repetitive sequences**: High density of repetitive elements that cause mapping ambiguity
- **Segmental duplications**: Large duplicated sequences (>1kb, >90% identity) that lead to misalignment
- **Centromeric and pericentromeric regions**: Highly repetitive sequences that are difficult to assemble
- **Heterozygous deletions**: Regions with copy number variations affecting sequencing depth

## Accessibility Masks

Accessibility masks are binary genomic tracks that define high-confidence regions for variant calling. These masks are typically generated by:

1. **Mappability analysis**: Identifying regions where short reads can be uniquely mapped
2. **Coverage uniformity**: Excluding regions with extreme coverage variations
3. **Repeat masking**: Filtering out known repetitive elements and low-complexity sequences
4. **Manual curation**: Removing problematic regions identified through empirical analysis

## Implementation

The following SLURM script demonstrates VCF filtering using bcftools with an accessibility mask:

```bash linenums="1"
#!/bin/bash
###################configuration slurm##############################
#SBATCH -A invalbo
#SBATCH --time=16:00:00
#SBATCH --job-name=accmerge
#SBATCH -p fast
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=8
#SBATCH --mem=16G
#SBATCH --array=1-5
#SBATCH --output=Cluster_logs/%x-%j-%N.out
#SBATCH --error=Cluster_logs/%x-%j-%N.err
#SBATCH --mail-user=loic.talignani@ird.fr
#SBATCH --mail-type=FAIL
####################################################################

start_time=$(date +%s)

# Récupération du nom du fichier BAM à partir du fichier de liste
CHROM=$(sed -n "${SLURM_ARRAY_TASK_ID}p" info_files/chrom.list)
INPUT_DIR="vcfs/"

# Répertoire de sortie pour les fichiers
OUTPUT_DIR="vcfs_filtered/"
mkdir -p ${OUTPUT_DIR}

# Load module
module load bcftools/1.15.1

bcftools view --threads 8 \
         ${INPUT_DIR}/combined.chr${CHROM}.vcf.gz \
         -T /shared/projects/invalbo/bwambae/Accessibility/accessibility.pass.${CHROM}.vcf.gz \
         -Oz -o ${OUTPUT_DIR}/combined.chr${CHROM}.acc.vcf.gz

bcftools index --threads 8 ${OUTPUT_DIR}/combined.chr${CHROM}.acc.vcf.gz

end_time=$(date +%s)  # Capture l'heure de fin
duration=$((end_time - start_time))  # Calcule la durée
echo "The script completed successfully in $((duration / 60)) minutes and $((duration % 60)) seconds."
```

## Key Parameters and Workflow

### BCFtools Parameters
- `--threads 8`: Utilizes 8 CPU cores for parallel processing
- `-T`: Specifies the target regions file (accessibility mask)
- `-Oz`: Outputs compressed VCF format
- `-o`: Defines the output file path

### Workflow Steps
1. **Chromosome selection**: The script processes chromosomes sequentially using SLURM array jobs
2. **Region filtering**: BCFtools applies the accessibility mask to retain only high-confidence regions
3. **Compression and indexing**: The filtered VCF is compressed and indexed for efficient downstream access
4. **Quality control**: Runtime monitoring ensures successful completion

## Benefits of Accessibility Filtering

### Improved Variant Quality
- **Reduced false positives**: Eliminates spurious variants from problematic genomic regions
- **Enhanced specificity**: Increases confidence in variant calls by focusing on reliable regions
- **Consistent genotyping**: Provides uniform variant calling across samples

### Downstream Analysis Advantages
- **Population genetics**: More accurate allele frequency estimates and demographic inferences
- **Association studies**: Reduced noise in genome-wide association studies (GWAS)
- **Phylogenetic analysis**: Improved resolution for evolutionary studies

## Considerations and Limitations

### Data Loss
Accessibility filtering removes variants from potentially important genomic regions, including:  
- Regulatory elements in heterochromatin  
- Structural variant breakpoints  
- Copy number variable regions  

### Mask Selection
The choice of accessibility mask significantly impacts results and should be:  
- **Species-specific**: Tailored to the organism's genome characteristics  
- **Technology-appropriate**: Matched to the sequencing platform and read length  
- **Analysis-specific**: Customized for the research question and population studied  

## Best Practices

1. **Document mask provenance**: Clearly record the source and generation method of accessibility masks  
2. **Validate filtering impact**: Assess the proportion of variants retained and their genomic distribution  
3. **Consider analysis goals**: Balance between data quality and genomic coverage based on research objectives  
4. **Benchmark performance**: Compare results with and without accessibility filtering to understand the impact  

## Conclusion

VCF filtering by genomic accessibility represents a fundamental quality control measure that enhances the reliability of variant calling by restricting analysis to high-confidence genomic regions. While this approach may reduce genomic coverage, it significantly improves the accuracy of downstream analyses by eliminating variants from problematic regions where sequencing artifacts are common. The implementation of accessibility filtering should be carefully considered based on the specific research goals and the characteristics of the study population.